{% extends "base.html" %}

{% block title %}Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª - ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©{% endblock %}

{% block content %}
<div class="categories-container">
    <div class="page-header">
        <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</h2>
        <button class="btn btn-primary" onclick="showAddModal()">
            <span class="icon">â•</span>
            Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ Ø¬Ø¯ÙŠØ¯
        </button>
    </div>

    <div class="categories-grid">
        <!-- ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø¯Ø®Ù„ -->
        <div class="category-section income-section">
            <h3>ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø¯Ø®Ù„</h3>
            <div class="categories-list">
                {% for category in categories['Ø¯Ø®Ù„'] %}
                <div class="category-card income">
                    <div class="category-info">
                        <h4>{{ category.name }}</h4>
                        <div class="category-stats">
                            <span class="usage-count">{{ category.usage_count }} Ø¹Ù…Ù„ÙŠØ©</span>
                            <span class="total-amount">{{ category.total_amount|format_money }}</span>
                        </div>
                    </div>
                    <div class="category-actions">
                        <button onclick="showEditModal({{ {
                            'id': category.id,
                            'name': category.name,
                            'type': category.type
                        }|tojson|safe }})" class="btn-icon" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</button>
                        {% if category.usage_count == 0 %}
                        <form onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙØŸ')"
                              action="{{ url_for('categories.delete_category', category_id=category.id) }}"
                              method="post"
                              style="display: inline;">
                            <button type="submit" class="btn-icon" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
                        </form>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ù…ØµØ±ÙˆÙ -->
        <div class="category-section expense-section">
            <h3>ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ù…ØµØ±ÙˆÙ</h3>
            <div class="categories-list">
                {% for category in categories['Ù…ØµØ±ÙˆÙ'] %}
                <div class="category-card expense">
                    <div class="category-info">
                        <h4>{{ category.name }}</h4>
                        <div class="category-stats">
                            <span class="usage-count">{{ category.usage_count }} Ø¹Ù…Ù„ÙŠØ©</span>
                            <span class="total-amount">{{ category.total_amount|format_money }}</span>
                        </div>
                    </div>
                    <div class="category-actions">
                        <button onclick="showEditModal({{ {
                            'id': category.id,
                            'name': category.name,
                            'type': category.type
                        }|tojson|safe }})" class="btn-icon" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</button>
                        {% if category.usage_count == 0 %}
                        <form onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙØŸ')"
                              action="{{ url_for('categories.delete_category', category_id=category.id) }}"
                              method="post"
                              style="display: inline;">
                            <button type="submit" class="btn-icon" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
                        </form>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„ØªÙˆÙÙŠØ± -->
        <div class="category-section saving-section">
            <h3>ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„ØªÙˆÙÙŠØ±</h3>
            <div class="categories-list">
                {% for category in categories['ØªÙˆÙÙŠØ±'] %}
                <div class="category-card saving">
                    <div class="category-info">
                        <h4>{{ category.name }}</h4>
                        <div class="category-stats">
                            <span class="usage-count">{{ category.usage_count }} Ø¹Ù…Ù„ÙŠØ©</span>
                            <span class="total-amount">{{ category.total_amount|format_money }}</span>
                        </div>
                    </div>
                    <div class="category-actions">
                        <button onclick="showEditModal({{ {
                            'id': category.id,
                            'name': category.name,
                            'type': category.type
                        }|tojson|safe }})" class="btn-icon" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</button>
                        {% if category.usage_count == 0 %}
                        <form onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙØŸ')"
                              action="{{ url_for('categories.delete_category', category_id=category.id) }}"
                              method="post"
                              style="display: inline;">
                            <button type="submit" class="btn-icon" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
                        </form>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø¥Ø¹Ø§Ù†Ø© -->
        <div class="category-section aid-section">
            <h3>ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø¥Ø¹Ø§Ù†Ø©</h3>
            <div class="categories-list">
                {% for category in categories['Ø¥Ø¹Ø§Ù†Ø©'] %}
                <div class="category-card aid">
                    <div class="category-info">
                        <h4>{{ category.name }}</h4>
                        <div class="category-stats">
                            <span class="usage-count">{{ category.usage_count }} Ø¹Ù…Ù„ÙŠØ©</span>
                            <span class="total-amount">{{ category.total_amount|format_money }}</span>
                        </div>
                    </div>
                    <div class="category-actions">
                        <button onclick="showEditModal({{ {
                            'id': category.id,
                            'name': category.name,
                            'type': category.type
                        }|tojson|safe }})" class="btn-icon" title="ØªØ¹Ø¯ÙŠÙ„">âœï¸</button>
                        {% if category.usage_count == 0 %}
                        <form onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙØŸ')"
                              action="{{ url_for('categories.delete_category', category_id=category.id) }}"
                              method="post"
                              style="display: inline;">
                            <button type="submit" class="btn-icon" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
                        </form>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ Ø¬Ø¯ÙŠØ¯ -->
    <div id="addModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ Ø¬Ø¯ÙŠØ¯</h3>
                <span class="close" onclick="closeAddModal()">&times;</span>
            </div>
            <form action="{{ url_for('categories.add_category') }}" method="post">
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„ØªØµÙ†ÙŠÙ:</label>
                    <input type="text" name="name" required minlength="2" maxlength="50">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù†ÙˆØ¹:</label>
                    <select name="type" required>
                        <option value="Ø¯Ø®Ù„">Ø¯Ø®Ù„</option>
                        <option value="Ù…ØµØ±ÙˆÙ">Ù…ØµØ±ÙˆÙ</option>
                        <option value="ØªÙˆÙÙŠØ±">ØªÙˆÙÙŠØ±</option>
                        <option value="Ø¥Ø¹Ø§Ù†Ø©">Ø¥Ø¹Ø§Ù†Ø©</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Ø¥Ø¶Ø§ÙØ©</button>
                    <button type="button" class="btn btn-light" onclick="closeAddModal()">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØµÙ†ÙŠÙ -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØµÙ†ÙŠÙ</h3>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            <form id="editForm" action="" method="post">
                <input type="hidden" name="old_name" id="editOldName">
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„ØªØµÙ†ÙŠÙ:</label>
                    <input type="text" name="name" id="editName" required minlength="2" maxlength="50">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù†ÙˆØ¹:</label>
                    <select name="type" id="editType" required>
                        <option value="Ø¯Ø®Ù„">Ø¯Ø®Ù„</option>
                        <option value="Ù…ØµØ±ÙˆÙ">Ù…ØµØ±ÙˆÙ</option>
                        <option value="ØªÙˆÙÙŠØ±">ØªÙˆÙÙŠØ±</option>
                        <option value="Ø¥Ø¹Ø§Ù†Ø©">Ø¥Ø¹Ø§Ù†Ø©</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                    <button type="button" class="btn btn-light" onclick="closeEditModal()">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
function showAddModal() {
    document.getElementById('addModal').style.display = 'block';
}

function closeAddModal() {
    document.getElementById('addModal').style.display = 'none';
}

// Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
function showEditModal(category) {
    const modal = document.getElementById('editModal');
    const form = document.getElementById('editForm');
    const oldNameInput = document.getElementById('editOldName');
    const nameInput = document.getElementById('editName');
    const typeInput = document.getElementById('editType');

    // Ø¨Ù†Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
    form.action = `/categories/edit/${category.id}`;  // ØªØºÙŠÙŠØ± Ø·Ø±ÙŠÙ‚Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø±Ø§Ø¨Ø·
    oldNameInput.value = category.name;
    nameInput.value = category.name;
    typeInput.value = category.type;

    modal.style.display = 'block';
}

function closeEditModal() {
    document.getElementById('editModal').style.display = 'none';
}

// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
window.onclick = function(event) {
    if (event.target.className === 'modal') {
        event.target.style.display = 'none';
    }
}

// ØªØ£Ø«ÙŠØ±Ø§Øª Ø­Ø±ÙƒÙŠØ© Ù„Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
document.querySelectorAll('.category-card').forEach(card => {
    card.addEventListener('mouseover', () => {
        card.style.transform = 'translateY(-2px)';
    });
    card.addEventListener('mouseout', () => {
        card.style.transform = 'translateY(0)';
    });
});
</script>
{% endblock %}