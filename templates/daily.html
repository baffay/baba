{% extends "base.html" %}

{% block title %}ุงููุชุงุจุนุฉ ุงูููููุฉ - ุชุทุจูู ุงููุงููุฉ{% endblock %}

{% block content %}
<div class="daily-container">
    <!-- ููุฎุต ุณุฑูุน -->
<div class="summary-cards">
    <!-- ุจุทุงูุฉ ุงูุฏุฎู -->
    <div class="stat-card income">
        <div class="stat-icon">๐ฐ</div>
        <div class="stat-info">
            <div class="stat-label">ุงูุฏุฎู</div>
            <div class="stat-amount">{{ summary['ุฏุฎู'].get('total', 0)|format_money }}</div>
            <div class="stat-count">{{ summary['ุฏุฎู'].get('count', 0) }} ุนูููุฉ</div>
        </div>
    </div>

    <!-- ุจุทุงูุฉ ุงููุตุฑูู -->
    <div class="stat-card expense">
        <div class="stat-icon">๐</div>
        <div class="stat-info">
            <div class="stat-label">ุงููุตุฑูู</div>
            <div class="stat-amount">{{ summary['ูุตุฑูู'].get('total', 0)|format_money }}</div>
            <div class="stat-count">{{ summary['ูุตุฑูู'].get('count', 0) }} ุนูููุฉ</div>
        </div>
    </div>

    <!-- ุจุทุงูุฉ ุงูุชูููุฑ -->
    <div class="stat-card saving">
        <div class="stat-icon">๐</div>
        <div class="stat-info">
            <div class="stat-label">ุงูุชูููุฑ</div>
            <div class="stat-amount">{{ summary['ุชูููุฑ'].get('total', 0)|format_money }}</div>
            <div class="stat-count">{{ summary['ุชูููุฑ'].get('count', 0) }} ุนูููุฉ</div>
        </div>
    </div>

    <!-- ุจุทุงูุฉ ุงูุฑุตูุฏ -->
    <div class="stat-card balance">
        <div class="stat-icon">โ๏ธ</div>
        <div class="stat-info">
            <div class="stat-label">ุงูุฑุตูุฏ</div>
            <div class="stat-amount">{{ summary['ุงูุฑุตูุฏ']|format_money }}</div>
            <div class="stat-trend">
                {% if summary['ุงูุฑุตูุฏ'] > 0 %}
                    <span class="positive">โฒ</span>
                {% else %}
                    <span class="negative">โผ</span>
                {% endif %}
            </div>
        </div>
    </div>
</div>

    <!-- ูููุฐุฌ ุฅุถุงูุฉ ุนูููุฉ -->
    <div class="form-section">
        <div class="section-header">
            <h3>ุฅุถุงูุฉ ุนูููุฉ ุฌุฏูุฏุฉ</h3>
            <button class="btn-toggle" onclick="toggleForm()">
                <span id="formToggleIcon">โผ</span>
            </button>
        </div>
        <form id="addForm" method="post" action="{{ url_for('daily.add_record') }}" onsubmit="return validateForm()">
            <div class="form-row">
                <div class="form-group">
                    <label>ุงูููุน:</label>
                    <select name="type" required onchange="updateFormStyle(this.value)">
                        <option value="ุฏุฎู">ุฏุฎู</option>
                        <option value="ูุตุฑูู">ูุตุฑูู</option>
                        <option value="ุชูููุฑ">ุชูููุฑ</option>
                        <option value="ุฅุนุงูุฉ">ุฅุนุงูุฉ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ุงูุชุตููู:</label>
                    <select name="category" required>
                        {% for cat in categories %}
                            <option value="{{ cat[0] }}">{{ cat[0] }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>ุงููุจูุบ:</label>
                    <input type="number" step="0.01" name="amount" required min="0.01">
                </div>
                <div class="form-group">
                    <label>ุงูุชุงุฑูุฎ:</label>
                    <input type="date" name="date" required value="{{ today }}">
                </div>
            </div>
            <div class="form-group">
                <label>ููุงุญุธุฉ:</label>
                <input type="text" name="note" placeholder="ุฃุถู ููุงุญุธุฉ (ุงุฎุชูุงุฑู)">
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">ุฅุถุงูุฉ ุงูุนูููุฉ</button>
                <button type="reset" class="btn btn-light">ูุณุญ ุงููููุฐุฌ</button>
            </div>
        </form>
    </div>

    <!-- ูุณู ุงูููุชุฑุฉ -->
    <div class="filter-section">
        <div class="section-header">
            <h3>ุฎูุงุฑุงุช ุงูุจุญุซ ูุงูููุชุฑุฉ</h3>
            <button class="btn-toggle" onclick="toggleFilter()">
                <span id="filterToggleIcon">โผ</span>
            </button>
        </div>
        <form id="filterForm" method="get" action="{{ url_for('daily.daily_home') }}">
            <div class="filter-row">
                <div class="filter-group">
                    <label>ุงููุชุฑุฉ:</label>
                    <select name="period" onchange="this.form.submit()">
                        <option value="all" {% if period=='all' %}selected{% endif %}>ูู ุงูุนูููุงุช</option>
                        <option value="today" {% if period=='today' %}selected{% endif %}>ุงูููู</option>
                        <option value="week" {% if period=='week' %}selected{% endif %}>ูุฐุง ุงูุฃุณุจูุน</option>
                        <option value="month" {% if period=='month' %}selected{% endif %}>ูุฐุง ุงูุดูุฑ</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ุงูููุน:</label>
                    <select name="filter_type" onchange="this.form.submit()">
                        <option value="">ูู ุงูุฃููุงุน</option>
                        <option value="ุฏุฎู" {% if filter_type=='ุฏุฎู' %}selected{% endif %}>ุฏุฎู</option>
                        <option value="ูุตุฑูู" {% if filter_type=='ูุตุฑูู' %}selected{% endif %}>ูุตุฑูู</option>
                        <option value="ุชูููุฑ" {% if filter_type=='ุชูููุฑ' %}selected{% endif %}>ุชูููุฑ</option>
                        <option value="ุฅุนุงูุฉ" {% if filter_type=='ุฅุนุงูุฉ' %}selected{% endif %}>ุฅุนุงูุฉ</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>ุงูุชุตููู:</label>
                    <select name="filter_category" onchange="this.form.submit()">
                        <option value="">ูู ุงูุชุตูููุงุช</option>
                        {% for cat in categories %}
                            <option value="{{ cat[0] }}" {% if filter_category==cat[0] %}selected{% endif %}>
                                {{ cat[0] }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-group">
                    <label>ุงููุจูุบ ูู:</label>
                    <input type="number" step="0.01" name="min_amount" value="{{ min_amount }}">
                </div>
                <div class="filter-group">
                    <label>ุงููุจูุบ ุฅูู:</label>
                    <input type="number" step="0.01" name="max_amount" value="{{ max_amount }}">
                </div>
                <div class="filter-group search-group">
                    <label>ุจุญุซ ูู ุงูููุงุญุธุงุช:</label>
                    <input type="text" name="search" value="{{ search }}" 
                           placeholder="ุงูุชุจ ูููุฉ ููุจุญุซ...">
                </div>
            </div>
            <div class="filter-actions">
                <button type="submit" class="btn btn-secondary">ุชุทุจูู ุงูููุชุฑ</button>
                <a href="{{ url_for('daily.daily_home') }}" class="btn btn-light">ูุณุญ ุงูููุชุฑ</a>
            </div>
        </form>
    </div>

    <!-- ุนุฑุถ ุงูุนูููุงุช -->
    {% for date, data in grouped_records.items() %}
    <div class="date-group">
        <div class="date-header">
            <h3>{{ date }}</h3>
            <div class="daily-totals">
                {% if data['totals']['ุฏุฎู'] > 0 %}
                    <span class="total income">
                        <i class="icon">๐ฐ</i>
                        {{ data['totals']['ุฏุฎู']|format_money }}
                    </span>
                {% endif %}
                {% if data['totals']['ูุตุฑูู'] > 0 %}
                    <span class="total expense">
                        <i class="icon">๐</i>
                        {{ data['totals']['ูุตุฑูู']|format_money }}
                    </span>
                {% endif %}
                {% if data['totals']['ุชูููุฑ'] > 0 %}
                    <span class="total saving">
                        <i class="icon">๐</i>
                        {{ data['totals']['ุชูููุฑ']|format_money }}
                    </span>
                {% endif %}
            </div>
        </div>
        
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>ุงูููุน</th>
                        <th>ุงูุชุตููู</th>
                        <th>ุงููุจูุบ</th>
                        <th>ููุงุญุธุฉ</th>
                        <th>ุฅุฌุฑุงุกุงุช</th>
                    </tr>
                </thead>
                <tbody>
                {% for record in data['records'] %}
                    <tr class="record-row {{ record['type'] }}-row">
                        <td>
                            <span class="type-badge {{ record['type'] }}">{{ record['type'] }}</span>
                        </td>
                        <td>{{ record['category'] }}</td>
                        <td class="amount {{ record['type'] }}-amount">
                            {{ record['amount']|format_money }}
                        </td>
                        <td class="note">{{ record['note'] or "โ" }}</td>
                        <td class="actions">
                            <a href="{{ url_for('daily.edit_record', record_id=record['id']) }}" 
                               class="btn btn-sm btn-edit" title="ุชุนุฏูู">
                                โ๏ธ
                            </a>
                            <form method="post" 
                                  action="{{ url_for('daily.delete_record', record_id=record['id']) }}" 
                                  style="display:inline;"
                                  onsubmit="return confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐู ุงูุนูููุฉุ')">
                                <button type="submit" class="btn btn-sm btn-delete" title="ุญุฐู">
                                    ๐๏ธ
                                </button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="no-records">
        <div class="empty-state">
            <div class="empty-icon">๐</div>
            <h3>ูุง ุชูุฌุฏ ุนูููุงุช</h3>
            <p>ูู ูุชู ุงูุนุซูุฑ ุนูู ุฃู ุนูููุงุช ุชุทุงุจู ูุนุงููุฑ ุงูุจุญุซ</p>
        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='app.js') }}"></script>
<script>
function toggleForm() {
    const form = document.getElementById('addForm');
    const icon = document.getElementById('formToggleIcon');
    form.classList.toggle('hidden');
    icon.textContent = form.classList.contains('hidden') ? 'โผ' : 'โฒ';
}

function toggleFilter() {
    const form = document.getElementById('filterForm');
    const icon = document.getElementById('filterToggleIcon');
    form.classList.toggle('hidden');
    icon.textContent = form.classList.contains('hidden') ? 'โผ' : 'โฒ';
}

function validateForm() {
    const amount = document.querySelector('input[name="amount"]').value;
    if (parseFloat(amount) <= 0) {
        alert('ุงููุจูุบ ูุฌุจ ุฃู ูููู ุฃูุจุฑ ูู ุตูุฑ');
        return false;
    }
    return true;
}
</script>
{% endblock %}