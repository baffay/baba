{% extends "base.html" %}

{% block title %}Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ÙŠÙˆÙ…ÙŠØ© - ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø§Ù„ÙŠØ©{% endblock %}

{% block content %}
<div class="daily-container">
    <!-- Ù…Ù„Ø®Øµ Ø³Ø±ÙŠØ¹ -->
<div class="summary-cards">
    <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¯Ø®Ù„ -->
    <div class="stat-card income">
        <div class="stat-icon">ğŸ’°</div>
        <div class="stat-info">
            <div class="stat-label">Ø§Ù„Ø¯Ø®Ù„</div>
            <div class="stat-amount">{{ summary['Ø¯Ø®Ù„'].get('total', 0)|format_money }}</div>
            <div class="stat-count">{{ summary['Ø¯Ø®Ù„'].get('count', 0) }} Ø¹Ù…Ù„ÙŠØ©</div>
        </div>
    </div>

    <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…ØµØ±ÙˆÙ -->
    <div class="stat-card expense">
        <div class="stat-icon">ğŸ“Š</div>
        <div class="stat-info">
            <div class="stat-label">Ø§Ù„Ù…ØµØ±ÙˆÙ</div>
            <div class="stat-amount">{{ summary['Ù…ØµØ±ÙˆÙ'].get('total', 0)|format_money }}</div>
            <div class="stat-count">{{ summary['Ù…ØµØ±ÙˆÙ'].get('count', 0) }} Ø¹Ù…Ù„ÙŠØ©</div>
        </div>
    </div>

    <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØªÙˆÙÙŠØ± -->
    <div class="stat-card saving">
        <div class="stat-icon">ğŸ’</div>
        <div class="stat-info">
            <div class="stat-label">Ø§Ù„ØªÙˆÙÙŠØ±</div>
            <div class="stat-amount">{{ summary['ØªÙˆÙÙŠØ±'].get('total', 0)|format_money }}</div>
            <div class="stat-count">{{ summary['ØªÙˆÙÙŠØ±'].get('count', 0) }} Ø¹Ù…Ù„ÙŠØ©</div>
        </div>
    </div>

    <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±ØµÙŠØ¯ -->
    <div class="stat-card balance">
        <div class="stat-icon">âš–ï¸</div>
        <div class="stat-info">
            <div class="stat-label">Ø§Ù„Ø±ØµÙŠØ¯</div>
            <div class="stat-amount">{{ summary['Ø§Ù„Ø±ØµÙŠØ¯']|format_money }}</div>
            <div class="stat-trend">
                {% if summary['Ø§Ù„Ø±ØµÙŠØ¯'] > 0 %}
                    <span class="positive">â–²</span>
                {% else %}
                    <span class="negative">â–¼</span>
                {% endif %}
            </div>
        </div>
    </div>
</div>

    <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© -->
    <div class="form-section">
        <div class="section-header">
            <h3>Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©</h3>
            <button class="btn-toggle" onclick="toggleForm()">
                <span id="formToggleIcon">â–¼</span>
            </button>
        </div>
        <form id="addForm" method="post" action="{{ url_for('daily.add_record') }}" onsubmit="return validateForm()">
            <div class="form-row">
                <div class="form-group">
                    <label>Ø§Ù„Ù†ÙˆØ¹:</label>
                    <select name="type" required onchange="updateFormStyle(this.value)">
                        <option value="Ø¯Ø®Ù„">Ø¯Ø®Ù„</option>
                        <option value="Ù…ØµØ±ÙˆÙ">Ù…ØµØ±ÙˆÙ</option>
                        <option value="ØªÙˆÙÙŠØ±">ØªÙˆÙÙŠØ±</option>
                        <option value="Ø¥Ø¹Ø§Ù†Ø©">Ø¥Ø¹Ø§Ù†Ø©</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ØªØµÙ†ÙŠÙ:</label>
                    <select name="category" required>
                        {% for cat in categories %}
                            <option value="{{ cat[0] }}">{{ cat[0] }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Ø§Ù„Ù…Ø¨Ù„Øº:</label>
                    <input type="number" step="0.01" name="amount" required min="0.01">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
                    <input type="date" name="date" required value="{{ today }}">
                </div>
            </div>
            <div class="form-group">
                <label>Ù…Ù„Ø§Ø­Ø¸Ø©:</label>
                <input type="text" name="note" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            </div>
            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</button>
                <button type="reset" class="btn btn-light">Ù…Ø³Ø­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
            </div>
        </form>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„ÙÙ„ØªØ±Ø© -->
    <div class="filter-section">
        <div class="section-header">
            <h3>Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ÙÙ„ØªØ±Ø©</h3>
            <button class="btn-toggle" onclick="toggleFilter()">
                <span id="filterToggleIcon">â–¼</span>
            </button>
        </div>
        <form id="filterForm" method="get" action="{{ url_for('daily.daily_home') }}">
            <div class="filter-row">
                <div class="filter-group">
                    <label>Ø§Ù„ÙØªØ±Ø©:</label>
                    <select name="period" onchange="this.form.submit()">
                        <option value="all" {% if period=='all' %}selected{% endif %}>ÙƒÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</option>
                        <option value="today" {% if period=='today' %}selected{% endif %}>Ø§Ù„ÙŠÙˆÙ…</option>
                        <option value="week" {% if period=='week' %}selected{% endif %}>Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</option>
                        <option value="month" {% if period=='month' %}selected{% endif %}>Ù‡Ø°Ø§ Ø§Ù„Ø´Ù‡Ø±</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Ø§Ù„Ù†ÙˆØ¹:</label>
                    <select name="filter_type" onchange="this.form.submit()">
                        <option value="">ÙƒÙ„ Ø§Ù„Ø£Ù†ÙˆØ§Ø¹</option>
                        <option value="Ø¯Ø®Ù„" {% if filter_type=='Ø¯Ø®Ù„' %}selected{% endif %}>Ø¯Ø®Ù„</option>
                        <option value="Ù…ØµØ±ÙˆÙ" {% if filter_type=='Ù…ØµØ±ÙˆÙ' %}selected{% endif %}>Ù…ØµØ±ÙˆÙ</option>
                        <option value="ØªÙˆÙÙŠØ±" {% if filter_type=='ØªÙˆÙÙŠØ±' %}selected{% endif %}>ØªÙˆÙÙŠØ±</option>
                        <option value="Ø¥Ø¹Ø§Ù†Ø©" {% if filter_type=='Ø¥Ø¹Ø§Ù†Ø©' %}selected{% endif %}>Ø¥Ø¹Ø§Ù†Ø©</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Ø§Ù„ØªØµÙ†ÙŠÙ:</label>
                    <select name="filter_category" onchange="this.form.submit()">
                        <option value="">ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</option>
                        {% for cat in categories %}
                            <option value="{{ cat[0] }}" {% if filter_category==cat[0] %}selected{% endif %}>
                                {{ cat[0] }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-group">
                    <label>Ø§Ù„Ù…Ø¨Ù„Øº Ù…Ù†:</label>
                    <input type="number" step="0.01" name="min_amount" value="{{ min_amount }}">
                </div>
                <div class="filter-group">
                    <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø¥Ù„Ù‰:</label>
                    <input type="number" step="0.01" name="max_amount" value="{{ max_amount }}">
                </div>
                <div class="filter-group search-group">
                    <label>Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
                    <input type="text" name="search" value="{{ search }}" 
                           placeholder="Ø§ÙƒØªØ¨ ÙƒÙ„Ù…Ø© Ù„Ù„Ø¨Ø­Ø«...">
                </div>
            </div>
            <div class="filter-actions">
                <button type="submit" class="btn btn-secondary">ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙ„ØªØ±</button>
                <a href="{{ url_for('daily.daily_home') }}" class="btn btn-light">Ù…Ø³Ø­ Ø§Ù„ÙÙ„ØªØ±</a>
            </div>
        </form>
    </div>

    <!-- Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
    {% for date, data in grouped_records.items() %}
    <div class="date-group">
        <div class="date-header">
            <h3>{{ date }}</h3>
            <div class="daily-totals">
                {% if data['totals']['Ø¯Ø®Ù„'] > 0 %}
                    <span class="total income">
                        <i class="icon">ğŸ’°</i>
                        {{ data['totals']['Ø¯Ø®Ù„']|format_money }}
                    </span>
                {% endif %}
                {% if data['totals']['Ù…ØµØ±ÙˆÙ'] > 0 %}
                    <span class="total expense">
                        <i class="icon">ğŸ“Š</i>
                        {{ data['totals']['Ù…ØµØ±ÙˆÙ']|format_money }}
                    </span>
                {% endif %}
                {% if data['totals']['ØªÙˆÙÙŠØ±'] > 0 %}
                    <span class="total saving">
                        <i class="icon">ğŸ’</i>
                        {{ data['totals']['ØªÙˆÙÙŠØ±']|format_money }}
                    </span>
                {% endif %}
            </div>
        </div>
        
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Ø§Ù„Ù†ÙˆØ¹</th>
                        <th>Ø§Ù„ØªØµÙ†ÙŠÙ</th>
                        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                        <th>Ù…Ù„Ø§Ø­Ø¸Ø©</th>
                        <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                    </tr>
                </thead>
                <tbody>
                {% for record in data['records'] %}
                    <tr class="record-row {{ record['type'] }}-row">
                        <td>
                            <span class="type-badge {{ record['type'] }}">{{ record['type'] }}</span>
                        </td>
                        <td>{{ record['category'] }}</td>
                        <td class="amount {{ record['type'] }}-amount">
                            {{ record['amount']|format_money }}
                        </td>
                        <td class="note">{{ record['note'] or "â€”" }}</td>
                        <td class="actions">
                            <a href="{{ url_for('daily.edit_record', record_id=record['id']) }}" 
                               class="btn btn-sm btn-edit" title="ØªØ¹Ø¯ÙŠÙ„">
                                âœï¸
                            </a>
                            <form method="post" 
                                  action="{{ url_for('daily.delete_record', record_id=record['id']) }}" 
                                  style="display:inline;"
                                  onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ')">
                                <button type="submit" class="btn btn-sm btn-delete" title="Ø­Ø°Ù">
                                    ğŸ—‘ï¸
                                </button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% else %}
    <div class="no-records">
        <div class="empty-state">
            <div class="empty-icon">ğŸ“</div>
            <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª</h3>
            <p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø¹Ù…Ù„ÙŠØ§Øª ØªØ·Ø§Ø¨Ù‚ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¨Ø­Ø«</p>
        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='app.js') }}"></script>
<script>
function toggleForm() {
    const form = document.getElementById('addForm');
    const icon = document.getElementById('formToggleIcon');
    form.classList.toggle('hidden');
    icon.textContent = form.classList.contains('hidden') ? 'â–¼' : 'â–²';
}

function toggleFilter() {
    const form = document.getElementById('filterForm');
    const icon = document.getElementById('filterToggleIcon');
    form.classList.toggle('hidden');
    icon.textContent = form.classList.contains('hidden') ? 'â–¼' : 'â–²';
}

function validateForm() {
    const amount = document.querySelector('input[name="amount"]').value;
    if (parseFloat(amount) <= 0) {
        alert('Ø§Ù„Ù…Ø¨Ù„Øº ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±');
        return false;
    }
    return true;
}
</script>
{% endblock %}